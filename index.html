<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Live Analytics Dashboard</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');

    body { font-family: 'Inter', sans-serif; background: #f3f4f6; margin:0; padding:20px; color:#111; }
    h1 { text-align:center; margin-bottom:20px; color:#111827; }

    .search-container { text-align:center; margin-bottom:40px; }
    .search-container input { padding:12px 16px; width:220px; border-radius:10px; border:1px solid #ccc; font-size:1rem; }
    .search-container button { padding:12px 20px; margin-left:10px; border:none; border-radius:10px; background:#2563eb; color:#fff; cursor:pointer; font-size:1rem; transition: background 0.3s; }
    .search-container button:hover { background:#1d4ed8; }

    .stats { display:flex; flex-wrap:wrap; justify-content:center; gap:20px; margin-bottom:50px; }
    .card { background:#fff; border-radius:16px; width:220px; padding:25px 20px; text-align:center; box-shadow:0 10px 20px rgba(0,0,0,0.08); transition: transform 0.3s, box-shadow 0.3s; }
    .card:hover { transform:translateY(-6px); box-shadow:0 14px 28px rgba(0,0,0,0.12); }
    .card .icon { font-size:36px; margin-bottom:12px; display:inline-block; padding:12px; border-radius:50%; background:#e0f2fe; color:#0284c7; }
    .card h2 { margin:0; font-size:2.2rem; color:#2563eb; }
    .card p { margin-top:8px; font-size:0.95rem; color:#6b7280; }

    table { width:100%; border-collapse:collapse; background:#fff; border-radius:10px; overflow:hidden; box-shadow:0 8px 24px rgba(0,0,0,0.06); margin-bottom:30px;}
    th, td { padding:14px 16px; text-align:left; }
    th { background:#2563eb; color:#fff; font-weight:600; }
    tr:nth-child(even){ background:#f9fafb; }
    tr:hover { background:#dbeafe; }

    .btn { padding:12px 24px; background:#ef4444; color:#fff; border:none; border-radius:10px; cursor:pointer; font-size:1rem; transition: background 0.3s; }
    .btn:hover { background:#dc2626; }

    .error { color:red; text-align:center; margin-bottom:20px; }
    @media (max-width:700px){ .stats { flex-direction:column; align-items:center; } .card{ width:80%; } }

    /* Modal Styles */
    .modal {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background-color: rgba(0, 0, 0, 0.6);
  z-index: 1000;
  animation: fadeIn 0.3s;
  padding: 20px;
}
.modal.show {
  display: block;
}
.modal-content {
  position: relative;
  background: #fff;
  margin: 10% auto;
  padding: 30px 20px;
  width: 100%;
  max-width: 1000px;
  border-radius: 20px;
  box-shadow: 0 16px 32px rgba(0,0,0,0.25);
  animation: slideUp 0.4s ease-out;
}

.modal-header {
  background: linear-gradient(90deg, #2563eb, #3b82f6);
  padding: 15px;
  border-radius: 16px 16px 0 0;
  color: #fff;
  text-align: center;
}

.modal-header h2 {
  margin: 0;
  font-size: 1.6rem;
}

.modal-body {
  padding: 20px 10px 0 10px;
}

.steps {
  padding-left: 20px;
}

.steps li {
  margin: 12px 0;
  font-size: 1rem;
  display: flex;
  align-items: center;
}

.step-icon {
  margin-right: 10px;
  font-size: 1.2rem;
}

code {
  display: block;
  background: #f3f4f6;
  padding: 8px 10px;
  border-radius: 8px;
  font-family: monospace;
  font-size: 0.9rem;
  overflow-x: auto;
}

.close-modal {
  position: absolute;
  right: 20px;
  top: 15px;
  font-size: 26px;
  cursor: pointer;
  color: #6b7280;
  transition: color 0.3s, transform 0.3s;
}

.close-modal:hover {
  color: #111827;
  transform: scale(1.2);
}

/* Animations */
@keyframes slideUp {
  0% { transform: translateY(50px); opacity: 0; }
  100% { transform: translateY(0); opacity: 1; }
}

@keyframes fadeIn {
  0% { background-color: rgba(0,0,0,0); }
  100% { background-color: rgba(0,0,0,0.6); }
}
  </style>
</head>
<body>
  <!-- Welcome Modal -->
  <div id="welcomeModal" class="modal">
     <span class="close-modal">&times;</span>
  <div class="modal-content">
   
    <div class="modal-header">
      <h2>üöÄ Welcome to Analytics Dashboard</h2>
    </div>
    <div class="modal-body">
      <p>This dashboard provides real-time analytics for your website. To get started:</p>
      <ol class="steps">
        <li><span class="step-icon">1Ô∏è‚É£</span> Add this code in your website</li>
        <li><span class="step-icon">2Ô∏è‚É£</span> 
          <code>&lt;script id="tracker" src="https://web-analytics-weld.vercel.app/tracker.js" data-site="YOUR_SITE_ID"&gt;&lt;/script&gt;</code>
        </li>
        <li><span class="step-icon">3Ô∏è‚É£</span> Start tracking visitors!</li>
      </ol>
    </div>
  </div>
</div>

  <h1>üìä Live Analytics Dashboard</h1>

  <div class="search-container">
    <input type="text" id="siteIdInput" placeholder="Enter Site ID" />
    <button onclick="loadSite()">Load Analytics</button>
  </div>
  <div id="errorMsg" class="error"></div>

  <div class="stats">
    <div class="card">
      <div class="icon">üëÅÔ∏è</div>
      <h2 id="totalViews">0</h2>
      <p>Total Views</p>
    </div>
    <div class="card">
      <div class="icon">üßë‚Äçü§ù‚Äçüßë</div>
      <h2 id="uniqueVisitors">0</h2>
      <p>Unique Visitors</p>
    </div>
    <div class="card">
      <div class="icon">‚ö°</div>
      <h2 id="eventsCount">0</h2>
      <p>Custom Events</p>
    </div>
  </div>

  <h2>Recent Activity</h2>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>URL</th>
        <th>Referrer</th>
        <th>User Agent</th>
        <th>Time</th>
      </tr>
    </thead>
    <tbody id="activityBody"></tbody>
  </table>

  <button class="btn" onclick="clearAnalytics()">Clear Analytics</button>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCy3wdI31dGW869qdPg08-KDuVmEyICILE",
      authDomain: "web--analytics.firebaseapp.com",
      databaseURL: "https://web--analytics-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "web--analytics",
      storageBucket: "web--analytics.firebasestorage.app",
      messagingSenderId: "740756570650",
      appId: "1:740756570650:web:d352ca5bcb75a9bcf947a3",
      measurementId: "G-YQMTM0SVZQ"
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const totalViewsEl = document.getElementById("totalViews");
    const uniqueVisitorsEl = document.getElementById("uniqueVisitors");
    const eventsCountEl = document.getElementById("eventsCount");
    const tbody = document.getElementById("activityBody");
    const errorDiv = document.getElementById("errorMsg");
    const siteInput = document.getElementById("siteIdInput");

    // Modal elements
    const modal = document.getElementById("welcomeModal");
    const closeBtn = document.querySelector(".close-modal");

    // Show modal when page loads
    window.onload = function() {
      modal.classList.add("show");
    }

    // Close modal when clicking the close button
    closeBtn.onclick = function() {
      modal.classList.remove("show");
    }

    // Close modal when clicking outside
    window.onclick = function(event) {
      if (event.target == modal) {
        modal.classList.remove("show");
      }
    }

    let currentRef = null;

    function renderDashboard(data) {
      const pageviews = data.filter(e => e.type === "pageview");
      totalViewsEl.textContent = pageviews.length;

      const unique = new Set(data.map(e => e.ref + e.url));
      uniqueVisitorsEl.textContent = unique.size;

      const events = data.filter(e => e.type === "event");
      eventsCountEl.textContent = events.length;

      tbody.innerHTML = "";
      data.slice(-10).reverse().forEach(e => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${e.type}</td>
          <td>${e.url || "-"}</td>
          <td>${e.ref || "-"}</td>
          <td>${e.userAgent || "-"}</td>
          <td>${new Date(e.ts).toLocaleString()}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    function loadSite() {
      const siteId = siteInput.value.trim();
      if (!siteId) {
        errorDiv.textContent = "Please enter a Site ID";
        return;
      }
      errorDiv.textContent = "";

      // Remove previous listener
      if (currentRef) currentRef.off();

      currentRef = db.ref("analytics/" + siteId);
      currentRef.on("value", snapshot => {
        const dataObj = snapshot.val() || {};
        const data = Object.values(dataObj).map(e => ({
          type: e.type || "pageview",
          url: e.url,
          ref: e.referrer,
          userAgent: e.userAgent,
          ts: e.timestamp
        }));
        renderDashboard(data);
      }, err => {
        errorDiv.textContent = "Firebase error: " + err.message;
      });
    }

    function clearAnalytics() {
      if (!currentRef) return;
      currentRef.remove();
    }
  </script>
</body>
</html>
